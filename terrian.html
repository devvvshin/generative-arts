<!DOCTYPE html>
<html>
<head>
  <script src='./lib/three.min.js'></script>
  <script src='./lib/OrbitControls.js'></script>
</haed>
<body>
  <script>

    const WIDTH = 600;
    const HEIGHT = 600;
    const SCL = 10;
    const ROWS = WIDTH / SCL;
    const COLS = HEIGHT / SCL;

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(WIDTH, HEIGHT);
    document.body.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
    camera.position.z = 300;

    const controls = new THREE.OrbitControls( camera );
    controls.enabled = true;

    const scene = new THREE.Scene();
    scene.add(camera);

    const draw = () => {

      let z = []
      for(let y = 0; y < ROWS; y++) {
        z.push([])
        for(let x = 0; x < COLS; x++) {
          z[y].push(-500 + Math.random() * -20);
        }
      }

      for(let y = 0; y < ROWS - 1; y++) {
        let geometry = new THREE.BufferGeometry();
        let material = new THREE.LineBasicMaterial({color: 0xffffff});
        let positions = new Float32Array((ROWS - 1) * 3 * 3);
        let line = new THREE.Line(geometry, material);
        geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3));
        var index = 0;

        for(let x = 0; x < COLS - 1; x++) {
          positions[ index ++ ] = x * SCL - WIDTH * 0.5;
          positions[ index ++ ] = y * SCL - HEIGHT * 0.5;
          positions[ index ++ ] = z[y][x];

          positions[ index ++ ] = x * SCL - WIDTH * 0.5;
          positions[ index ++ ] = (y + 1) * SCL - HEIGHT * 0.5;
          positions[ index ++ ] = z[y+1][x];

          positions[ index ++ ] = (x + 1) * SCL - WIDTH * 0.5;
          positions[ index ++ ] = (y + 1) * SCL - HEIGHT * 0.5;
          positions[ index ++ ] = z[y+1][x+1];
        }

        scene.add(line);
      }


    }

    draw();

    function animate() {
      requestAnimationFrame( animate );
      controls.update();
      render();
    }

    function render() {
      renderer.render( scene, camera );
    }

    render();
    animate();

  </script>
</body>
</html>
